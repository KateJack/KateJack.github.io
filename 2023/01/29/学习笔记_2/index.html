<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <title>Docker 学习笔记 [ 洪志鑫技术博客 ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/iLiKE.css">
    
  
  
  
  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
    <script id="leancloud">
      AV.init({
          appId: "6E5zTbTljdUbVW2WkXPsXGJk-gzGzoHsz",
          appKey: "0vsyDKfNpeSECAI70J794ugv"
      });
    </script>

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="/favicon.ico"></img>
        </a>
      </div>
      <div class="menu-right">
        
          
          
          
          
          
          
          <a href="/">Home</a>
        
          
          
          
          
          
          
          <a href="/archives">Archives</a>
        
      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">Docker 学习笔记</h1>
<article class="post markdown-style">
  <h1 id="Docker-学习笔记"><a href="#Docker-学习笔记" class="headerlink" title="Docker 学习笔记"></a>Docker 学习笔记</h1><h1 id="学习大纲"><a href="#学习大纲" class="headerlink" title="学习大纲"></a>学习大纲</h1><ul>
<li><h5 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h5></li>
<li><p>Docker安装</p>
</li>
<li><p>Docker命令</p>
<ul>
<li>镜像命令</li>
<li>镜像命令</li>
<li>操作命令</li>
<li>…</li>
</ul>
</li>
<li><p>Docker镜像</p>
</li>
<li><p>镜像数据卷</p>
</li>
<li><p>DockerFile</p>
</li>
<li><p>Docker网络原理</p>
</li>
<li><p>IDEA整合Docker</p>
</li>
<li><p>Docker Compose</p>
</li>
<li><p>Docker Swarm</p>
</li>
<li><p>CI\CD jenkins</p>
<p>一个优秀的全栈开发程序员应有的学习心态：</p>
<p>即使再小的帆，也能远行！</p>
<p>只要学不死，就往死里学！</p>
<p>呼吸不停，学习不止！</p>
<p>拥抱变化，一切不变的只有变化本身！</p>
</li>
</ul>
<h1 id="Docker概述-1"><a href="#Docker概述-1" class="headerlink" title="Docker概述"></a>Docker概述</h1><h2 id="Docker为什么会出现？"><a href="#Docker为什么会出现？" class="headerlink" title="Docker为什么会出现？"></a>Docker为什么会出现？</h2><blockquote>
<p>传统开发生命周期代理的问题和挑战：</p>
</blockquote>
<p>一款产品：开发上线 多套环境！应用环境，应用配置！</p>
<p>开发….  运维。问题：我在我的电脑上可以运行！版本更新导致服务器不可用！对运维来说，考验十分大？</p>
<p>环境配置是十分麻烦的，每个环境都要部署环境（集群Redis、ES、Hadood…..）费事费力。</p>
<p>发布一个项目（jar+(Redis Mysql jdk ES)）项目能不能带上环境一起安装打包呢？</p>
<p>之前的服务器配置一个应用的环境Redis Mysql jdk ES Hadood 超麻烦了，不能跨平台。</p>
<p>通常在Windows上开发最后到linux上！</p>
<blockquote>
<p>Docker给出了解决方案:</p>
</blockquote>
<p>传统：开发Jar 运维来做！</p>
<p>现在：开发打包部署上线一套环境，一套流程做完！</p>
<p>jar -&gt; jar -&gt; 发布(应用商店) -&gt; 张三使用apk -&gt; 安装既可以使用！</p>
<p>java –&gt; jar （环境）–&gt;打包项目带上环境(镜像)-&gt;(Docker仓库：商店) –&gt; 下载我们发布的镜像 -&gt; 直接运行即可！</p>
<p>以上就是Docker给以上问题给出了解决方案！</p>
<blockquote>
<p>Docker的思想来源于集装箱：</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210113010041.png" alt="image-20210113010033581"></p>
<p>JRE – 多个应用(端口冲突) – 原来都是交叉的！</p>
<p>隔离：Docker核心思想，打包装箱，每个箱子都是相互隔离的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210113010348.png" alt="image-20210113010348334"></p>
<p>集装箱思维：水果、生化武器、相互隔离！D</p>
<p>Docker 通过镜像机制，可以将服务器利用到极致！</p>
<blockquote>
<p>本质：所有的技术都是随着问题的出现，我们需要找到解决方案，才去学习！</p>
</blockquote>
<h2 id="Docker的历史"><a href="#Docker的历史" class="headerlink" title="Docker的历史"></a>Docker的历史</h2><p>2010年，几个搞IT的年轻人，就在美国建立了一家公司 dotCloud</p>
<p>做一些pass的云计算服务！LXC有关的镜像技术！</p>
<p>他们将自己的技术(镜像化技术)命名就是Docker</p>
<p>Docker刚刚诞生的时候，没有引起业内的关注！dotCloud,活不下去!</p>
<blockquote>
<p>开源</p>
</blockquote>
<p>开放源代码</p>
<p>2013年，Docker开源！</p>
<p>Docker 被越来越多的人发现了它的优点！迅速的火了！</p>
<p>Docker几乎每个月都更新一个版本！</p>
<p>2014年4月9号，Docker1.0发布！</p>
<blockquote>
<p>Docker为什么这么火？</p>
</blockquote>
<p>Docker十分轻巧!</p>
<p>在镜像技术出现之前，我们都是使用虚拟机技术！</p>
<p>虚拟机：在windows上利用Vmware这个软件虚拟出来一台或者多台电脑！笨重！</p>
<p>虚拟机也属于虚拟技术，Docke容器技术也是一种虚拟技术！</p>
<p>vmware linux centos 原生镜像(一个电脑) 隔离需要开多个虚拟机！</p>
<p>Docker 隔离 镜像(最核心的环境 4m + jdk + mysql )十分的小巧、运行镜像就可以了，小巧，几个M KB 秒级启动！</p>
<p>到现在，所有开发人员都必须要具备的技术！</p>
<blockquote>
<p>聊聊Docker </p>
</blockquote>
<p>Docker是基于Go语言编写的！开源项目！</p>
<ul>
<li>官网：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com</a></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210116011043.png" alt="image-20210115002603259"></p>
<ul>
<li>文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com</a></li>
<li>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></li>
</ul>
<h2 id="Docker能干嘛"><a href="#Docker能干嘛" class="headerlink" title="Docker能干嘛"></a>Docker能干嘛</h2><blockquote>
<p>之前的虚拟机技术</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210116011055.png" alt="image-20210115010524389"></p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210116013245.png" alt="image-20210116013245715"></p>
<blockquote>
<p>虚拟机技术缺点：</p>
</blockquote>
<ol>
<li>资源占用十分多！</li>
<li>冗余步骤多！</li>
<li>启动很慢！</li>
</ol>
<blockquote>
<p>比较Docker和虚拟机技术的不同:</p>
</blockquote>
<ul>
<li>传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>镜像内的应用直接运行在宿主机的内核，镜像是没有自己内核的，也没有虚拟我们的硬件，所以就轻便了</li>
<li>每个镜像都互相隔离，每个镜像都有一个属于自己的文件系统，互不影响。</li>
</ul>
<blockquote>
<p>DevOps（开发，运维）</p>
</blockquote>
<p><strong>应用更快速的交付和部署</strong></p>
<p>传统：一堆安装文档，安装程序</p>
<p>Docker：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用Docker之后，我们部署的应用就像搭积木一样</p>
<p>项目打包一个镜像，扩展服务器A！服务器B</p>
<p><strong>更简单的系统运维</strong></p>
<p>在镜像化之后，我们的开发，测试，生产环境都是一致的。</p>
<p><strong>更高效的计算资源利用</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多镜像实例！服务器的性能可以被压榨到极致。</p>
<p>只要学不死，就往死里学！</p>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210116015109.png" alt="image-20210116015108946"></p>
<p><strong>镜像(Image)：</strong></p>
<p>docker镜像就好比一个模板可以用这个模板创建一个镜像，tomcat镜像&#x3D;&#x3D;&gt;run &#x3D;&#x3D;&gt;tomcat01容器(提供服务器)</p>
<p><strong>镜像(container)：</strong></p>
<p>Docker利用镜像技术，独立运行了一个或者一组应用，通过镜像来创建。</p>
<p>启动，停止，删除，基本命令</p>
<p>目前就可以把镜像理解为就是一个简易的linux系统</p>
<p><strong>仓库(repository)：</strong></p>
<p>仓库是存放镜像的地方！</p>
<p>仓库分为共有仓库和私有仓库！</p>
<p>Docker Hub （默认国外的仓库）</p>
<p>阿里云……都有镜像服务器（配置镜像加速）</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><blockquote>
<p>环境准备：</p>
</blockquote>
<ol>
<li>需要会一点点linux的基础</li>
<li>Centos7以上</li>
<li>我们使用xshell来连接远程服务器进行操作练习</li>
</ol>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">系统内核是3.10内核以上即可</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# uname -r</span><br><span class="line">4.18.0-147.5.1.el8_1.x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">系统版本</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;8 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;8&quot;</span><br><span class="line">PLATFORM_ID=&quot;platform:el8&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 8 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:8&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-8&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;8&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;8&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装</p>
</blockquote>
<p>官方帮助文档</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、卸载旧的版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line">                  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、需要的安装包</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、设置镜像的仓库</span></span><br><span class="line"></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo #默认国外镜像，国内不推荐用</span><br><span class="line"></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #推荐使用阿里云的镜像,国内十分快速</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新yum软件包索引</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">yum makecache fast</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">centos8以后没有fast参数</span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、安装docker相关的引擎 docker-ce 社区 ee 企业版本</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认安装最新版本</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定版本</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#列出在本地仓库可用的版本：</span></span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            18.03.1.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            18.03.0.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.12.1.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.12.0.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.09.1.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.09.0.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.06.2.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.06.1.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-ce.x86_64            17.06.0.ce-1.el7.centos             docker-ce-stable</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#安装指定版本：</span></span></span><br><span class="line">yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br><span class="line">例子：</span><br><span class="line">yum install docker-ce-18.03.1 docker-ce-cli-18.03.1 containerd.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Installed:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> docker-ce-3:20.10.2-3.el7.x86_64                             docker-ce-cli-1:20.10.2-3.el7.x86_64                      docker-ce-rootless-extras-20.10.2-3.el7.x86_64</span>   </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> fuse-overlayfs-1.1.2-3.module_el8.3.0+507+aa0970ae.x86_64    fuse3-libs-3.2.1-12.el8.x86_64                            libcgroup-0.41-19.el8.x86_64</span>                     </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> libslirp-4.3.1-1.module_el8.3.0+475+c50ce30b.x86_64          slirp4netns-1.1.4-2.module_el8.3.0+475+c50ce30b.x86_64</span>   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#Complete!</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">5、启动Docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">6、使用docker -version 测试是否按照成功！</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210118005636.png" alt="image-20210118005515203"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">7、hello-word</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210118005636.png" alt="image-20210118005636189"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">8、查看一下下载的这个hello-world 镜像</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    bf756fb1ae65   12 months ago   13.3kB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="卸载Docker"><a href="#卸载Docker" class="headerlink" title="卸载Docker"></a>卸载Docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、卸载依赖</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、删除资源</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/var/lib/docker docker的默认工作目录</span></span><br></pre></td></tr></table></figure>

<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><h3 id="1、登录阿里云找到镜像服务"><a href="#1、登录阿里云找到镜像服务" class="headerlink" title="1、登录阿里云找到镜像服务"></a>1、登录阿里云找到镜像服务</h3><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210118011029.png" alt="image-20210118011029840"></p>
<h3 id="2、找到镜像加速器"><a href="#2、找到镜像加速器" class="headerlink" title="2、找到镜像加速器"></a>2、找到镜像加速器</h3><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210118011315.png" alt="image-20210118011315833"></p>
<h3 id="3、配置使用"><a href="#3、配置使用" class="headerlink" title="3、配置使用"></a>3、配置使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://gcp5abpr.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>



<h2 id="回顾HelloWorld"><a href="#回顾HelloWorld" class="headerlink" title="回顾HelloWorld"></a>回顾HelloWorld</h2><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210118005636.png" alt="image-20210118005636189"></p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210119004134.png" alt="image-20210119004133933"></p>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p>Dockers是怎么工作的？</p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上，通过Socket从客户端访问！</p>
<p>Docker Server 接收到Docker-Client的指令，就会执行这个命令！</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210119005453.png" alt="image-20210119005452766"></p>
<h2 id="Docker为什么比VM快？"><a href="#Docker为什么比VM快？" class="headerlink" title="Docker为什么比VM快？"></a>Docker为什么比VM快？</h2><p>1、Docker有比虚拟机更少是抽象层。</p>
<p>2、docker利用的是宿主的内核，vm需要的是Guest OS.</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210119005709.png" alt="image-20210119005708866"></p>
<p>所以说，新建一个镜像的时候，docker不需要像虚拟机一样从新加载一个虚拟机的内核，避免了引导，虚拟机是加载Guset OS,分钟级别而Docker是利用宿主机的操作系统，省略了这个过程，秒级启动！</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210119010117.png" alt="image-20210119010116683"></p>
<p>之后学习完毕所有命令，再回头过来看下这段</p>
<h1 id="Docker的常用命令"><a href="#Docker的常用命令" class="headerlink" title="Docker的常用命令"></a>Docker的常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version #显示docker的版本信息</span><br><span class="line">docker info #显示docker的系统信息，包括镜像和镜像的数量</span><br><span class="line">docker 命令 --help #帮助命令 万能</span><br></pre></td></tr></table></figure>

<p>帮助文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/">https://docs.docker.com/engine/reference/commandline/</a></p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><p><strong>docker images 查看所有本地主机上的镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    bf756fb1ae65   12 months ago   13.3kB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY   #镜像的仓库</span><br><span class="line">TAG          #镜像的标签</span><br><span class="line">CREATED      #镜像的创建时间</span><br><span class="line">SIZE         #镜像的大小</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可选项</span></span><br><span class="line">-a --all     #列出所有的镜像</span><br><span class="line">-q ---quiet  #只显示镜像的ID</span><br></pre></td></tr></table></figure>

<p><strong>docker search 搜索镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker search mysql</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   10380     [OK]       </span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MyS…   3848      [OK]       </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   758                  [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   519       [OK] </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可选项，通过搜索来过滤</span></span><br><span class="line">--filter=STARS=3000 #搜索出的镜像就是STARS大于3000的</span><br><span class="line"></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   10380     [OK]       </span><br><span class="line">mariadb   MariaDB is a community-developed fork of MyS…   3848      [OK]  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>docker pull</strong> 下载镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载镜像docker pull 镜像名[:tag]</span></span><br><span class="line"></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker pull mysql</span><br><span class="line">Using default tag: latest #如果不写明tag 默认就会下载最新版本</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete  #分层下载，docker iamges 的核心 联合文件系统</span><br><span class="line">f6c208f3f991: Pull complete </span><br><span class="line">88a9455a9165: Pull complete </span><br><span class="line">406c9b8427c6: Pull complete </span><br><span class="line">7c88599c0b25: Pull complete </span><br><span class="line">25b5c6debdaf: Pull complete </span><br><span class="line">43a5816f1617: Pull complete </span><br><span class="line">1a8c919e89bf: Pull complete </span><br><span class="line">9f3cf4bd1a07: Pull complete </span><br><span class="line">80539cea118d: Pull complete </span><br><span class="line">201b3cad54ce: Pull complete </span><br><span class="line">944ba37e1c06: Pull complete </span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c #签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker pull mysql</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete </span><br><span class="line">f6c208f3f991: Pull complete </span><br><span class="line">88a9455a9165: Pull complete </span><br><span class="line">406c9b8427c6: Pull complete </span><br><span class="line">7c88599c0b25: Pull complete </span><br><span class="line">25b5c6debdaf: Pull complete </span><br><span class="line">43a5816f1617: Pull complete </span><br><span class="line">1a8c919e89bf: Pull complete </span><br><span class="line">9f3cf4bd1a07: Pull complete </span><br><span class="line">80539cea118d: Pull complete </span><br><span class="line">201b3cad54ce: Pull complete </span><br><span class="line">944ba37e1c06: Pull complete </span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">真实地址</span></span><br><span class="line"></span><br><span class="line">docker pull mysql 等价于 docker pull docker.io/library/mysql:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定版本下载</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists </span><br><span class="line">f6c208f3f991: Already exists </span><br><span class="line">88a9455a9165: Already exists </span><br><span class="line">406c9b8427c6: Already exists </span><br><span class="line">7c88599c0b25: Already exists </span><br><span class="line">25b5c6debdaf: Already exists </span><br><span class="line">43a5816f1617: Already exists </span><br><span class="line">1831ac1245f4: Pull complete </span><br><span class="line">37677b8c1f79: Pull complete </span><br><span class="line">27e4ac3b0f6e: Pull complete </span><br><span class="line">7227baa8c445: Pull complete </span><br><span class="line">Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210122002418.png" alt="image-20210122002411224"></p>
<p><strong>docker rmi 删除镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker rmi -f a70d36bc331a #删除指定的镜像</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker rmi -f 镜像id1 镜像id2 镜像id3 #删除多个镜像</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker rmi -f $(docker images -aq) #删除全部镜像</span><br></pre></td></tr></table></figure>



<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>说明：我们有了镜像才可以创建容器，linux, 下载一个contos镜像来测试学习</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line">--name=&quot;Name&quot; 容器的名字 tomcat01 tomcat02 用来区分容器</span><br><span class="line">-d            后台方式运行</span><br><span class="line">-it           使用交互方式运行，进入容器查看内容</span><br><span class="line">-p            指定容器的端口 -p 8080:8080</span><br><span class="line">	-p  ip:主机端口:容器端口</span><br><span class="line">	-p  主机端口:容器端口（常用）</span><br><span class="line">-P (大写)      随机指定端口</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试，启动并进入容器</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@8d317a4f73cc /]# ls 查看容器内的contos,基础版本，很多命令都是不完善的！</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从容器中退回到主机（直接容器停止并且退出）</span></span><br><span class="line">[root@fd17746636a9 /]# exit </span><br><span class="line">exit</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# ls</span><br><span class="line">install.sh  package.xml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出容器 容器不停止退出</span></span><br><span class="line">Ctrl + P + Q #容器不停止退出快捷键</span><br></pre></td></tr></table></figure>

<p><strong>列出所有运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker ps 命令</span> </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">列出当前正在运行的容器</span></span><br><span class="line">-a	#列出当前正在运行的容器+带出历史运行过的容器</span><br><span class="line">-n=? #显示最近运行的容器</span><br><span class="line">-q #只显示容器的编号</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">fd17746636a9   centos         &quot;/bin/bash&quot;   3 minutes ago    Exited (0) 3 minutes ago               intelligent_mccarthy</span><br><span class="line">a55c57e71499   centos         &quot;/bin/bash&quot;   4 minutes ago    Exited (127) 3 minutes ago             nice_lederberg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id								  #删除指定的容器 不能删除正在运行中的容器 如果要删除要加参数 rm -f </span><br><span class="line">docker rm -f $(docker ps -aq)    #删除所有的容器</span><br><span class="line">docker ps -a -q|xargs docker rm  #删除所有的容器 </span><br></pre></td></tr></table></figure>

<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id   #启动容器</span><br><span class="line">docker restart 容器id #重启容器</span><br><span class="line">docker stop 容器id    #停止当前正在运行的容器</span><br><span class="line">docker kill 容器id 	  #强制停止当前容器</span><br></pre></td></tr></table></figure>

<p><strong>常用的其他命令</strong></p>
<p><strong>后台启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令 docker run -d centos</span> </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题docker ps 发现 centos 停止了</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常见的坑，docker 容器使用后台运行，就必须要有一个前台进程，docker发现没有应用后，就会自动停止</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx,容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">自己编写了一段shell脚本</span></span><br><span class="line">run -d centos /bin/sh -c &quot;while true;do echo kuangshen;sleep 1; done&quot;</span><br><span class="line"></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS     NAMES</span><br><span class="line">8bded8b1dc93   centos    &quot;/bin/sh -c &#x27;while t…&quot;   6 hours ago   Up 6 hours             peaceful_gates</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示日志</span></span><br><span class="line">-tf      		 #显示日志</span><br><span class="line">-tail number #要显示日志的条数 </span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]#  docker logs -tf --tail 10 8bded8b1dc93</span><br><span class="line">2021-01-23T16:05:42.469005189Z kuangshen</span><br><span class="line">2021-01-23T16:05:43.470964356Z kuangshen</span><br><span class="line">2021-01-23T16:05:44.472987287Z kuangshen</span><br><span class="line">2021-01-23T16:05:45.474860613Z kuangshen</span><br><span class="line">2021-01-23T16:05:46.476780034Z kuangshen</span><br><span class="line">2021-01-23T16:05:47.478800165Z kuangshen</span><br><span class="line">2021-01-23T16:05:48.481193073Z kuangshen</span><br><span class="line">2021-01-23T16:05:49.490360044Z kuangshen</span><br><span class="line">2021-01-23T16:05:50.493086207Z kuangshen</span><br><span class="line">2021-01-23T16:05:51.494865358Z kuangshen</span><br><span class="line">2021-01-23T16:05:52.496736751Z kuangshen</span><br><span class="line">2021-01-23T16:05:53.497663079Z kuangshen</span><br><span class="line">2021-01-23T16:05:54.503506869Z kuangshen</span><br></pre></td></tr></table></figure>

<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令 docker top 容器<span class="built_in">id</span></span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker top 8bded8b1dc93</span><br><span class="line">UID                 PID                 PPID                C                   STIME     </span><br><span class="line">root                11940               27619               0                   00:09     </span><br><span class="line">root                27619               27599               0                   Jan23</span><br></pre></td></tr></table></figure>

<p><strong>查看容器的源数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令 docker inspect 容器<span class="built_in">id</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker inspect 8bded8b1dc93</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-01-23T09:36:31.339903754Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo kuangshen;sleep 1; done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 27619,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-01-23T09:36:36.43730251Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634/8bded8b1dc93a6a750fb7a2f85a84d60944a98ccc653556ced6bba56d9566634-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/peaceful_gates&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/39dd1a0e59f84f2e0fa126e038d11fc416a9ef95a52bb3b12cb4e3db7e865828-init/diff:/var/lib/docker/overlay2/3871c2fb277e335acfa215dd8d087ec78f60b86e320a86c144fd11272dccda88/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/39dd1a0e59f84f2e0fa126e038d11fc416a9ef95a52bb3b12cb4e3db7e865828/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/39dd1a0e59f84f2e0fa126e038d11fc416a9ef95a52bb3b12cb4e3db7e865828/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/39dd1a0e59f84f2e0fa126e038d11fc416a9ef95a52bb3b12cb4e3db7e865828/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;8bded8b1dc93&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo kuangshen;sleep 1; done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;eb927f207c6de0f373287ccb8330baeba0647ef798fffc7c47a12bfb4524dfe7&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/eb927f207c6d&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;78fbdeef98c55ba031a9c1608b968656b817657bf3b15349fdd08c07c88f47ba&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;a4453bfa54c2b70c6de8520158410b1136e4b5ea836315b88471de6649bbad49&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;78fbdeef98c55ba031a9c1608b968656b817657bf3b15349fdd08c07c88f47ba&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们通常容器是使用后台方式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式一 命令</span></span><br><span class="line">docker exec it 容器id bashshell</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS     NAMES</span><br><span class="line">8bded8b1dc93   centos    &quot;/bin/sh -c &#x27;while t…&quot;   7 hours ago   Up 7 hours             peaceful_gates</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it 8bded8b1dc93 /bin/bash</span><br><span class="line">[root@8bded8b1dc93 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@8bded8b1dc93 /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 09:36 ?        00:00:07 /bin/sh -c while true;do echo kuangshen;sleep 1; done</span><br><span class="line">root     24819     0  6 16:30 pts/0    00:00:00 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二 命令</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker attach 8bded8b1dc93</span><br><span class="line">正在执行当前代码……</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">区别</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span>    <span class="comment"># 进入容器后开启了一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker attach  <span class="comment"># 进入容器正在执行的终端，不会启动新的进程！</span></span></span><br></pre></td></tr></table></figure>

<p><strong>从容器内拷贝文件到主机服务器上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径 目的地主机路径</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台运行</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@945c042f628b /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@945c042f628b /]# [root@iZwz9j1nogjvor6cio432eZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">945c042f628b   centos    &quot;/bin/bash&quot;   27 seconds ago   Up 23 seconds             quirky_blackburn</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入docker容器内部</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker attach 945c042f628b</span><br><span class="line">[root@945c042f628b /]# cd /home/</span><br><span class="line">[root@945c042f628b home]# ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在容器内新建一个文件</span></span><br><span class="line">[root@945c042f628b home]# touch test.java</span><br><span class="line">[root@945c042f628b home]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@945c042f628b home]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将这个文件拷贝出来到主机上</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker cp 945c042f628b:/home/test.java /home</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# ls</span><br><span class="line">li5220008.java  redis  test.java  www</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝是一个手动过程，未来我们使用 -v 卷的技术， 可以实现</span></span><br></pre></td></tr></table></figure>

<p>学习方式：将我的所有命令全部敲一遍，加深记忆！</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h2><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210124010426.png" alt="image-20210124010425970"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attach  </span><br></pre></td></tr></table></figure>

<p>docker的命令是十分多的，上面我们学习的都是最常用的容器和镜像命令，之后我们还会学习很多命令！</p>
<blockquote>
<p>接下来就是一堆练习</p>
</blockquote>
<h2 id="作业练习"><a href="#作业练习" class="headerlink" title="作业练习"></a>作业练习</h2><blockquote>
<p>Docker 安装Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、搜索镜像 search 建议通过官方的网站搜索，可以看到镜像的详细信息</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、下载镜像 pull</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、运行测试</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">a076a628af6f: Pull complete </span><br><span class="line">0732ab25fa22: Pull complete </span><br><span class="line">d7f36f6fe38f: Pull complete </span><br><span class="line">f72584a26f32: Pull complete </span><br><span class="line">7125e4df9063: Pull complete </span><br><span class="line">Digest: sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aa</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    f6d0b4767a6c   11 days ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   6 weeks ago   209MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name 给容器实例命名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 宿主机端口:容器内部端口</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">461579aed62fd1ce47db651d3dbb3b58ec9f2cc51c2eacf5280942f80a369364</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS                  NAMES</span><br><span class="line">461579aed62f   nginx     &quot;/docker-entrypoint.…&quot;   10 seconds ago   Up 2 seconds   0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@461579aed62f:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@461579aed62f:/# cd /etc/nginx</span><br><span class="line">root@461579aed62f:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params	uwsgi_params  win-utf</span><br><span class="line">root@461579aed62f:/etc/nginx# </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>端口暴露的概念</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210125003911.png" alt="image-20210125003904467"></p>
<p>思考一个问题：我们每次改动nginx配置文件，都需要进入容器内部？十分的麻烦，我要是可以在容器外面提供一个映射路径，达到在容器修改文件名，容器内就可以自动修改？ -v 后面我们就会用到容器数据卷的功能！</p>
<blockquote>
<p>作业：docker 来装一个tomcat</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，容器还可以查到，docker -it --<span class="built_in">rm</span> 用完即删除，一般用于测试</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载再启动</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动运行</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试访问没有问题</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现问题：1、 linux 命令少了；2、没有webapps 阿里云镜像的原因，morning是最小的镜像，所有不必要的都会剔除掉,保证最小的可运行环境!</span></span><br><span class="line"></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line">e2656e05441ec8bc83816de5e779e0f1a0470206b465dc8b726095ac6cbeaee5</span><br></pre></td></tr></table></figure>

<p>思考问题：我们以后要部署项目，如果每次都要进入容器是不是十分的麻烦？我要是可以在容器外部提供一个映射路径，webapps，我们在外部放置项目，就自动同步到内部就好了！</p>
<blockquote>
<p>作业：部署es + kibana</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 暴露的端口很多</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 十分的耗内存</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 的数据一般都需要放置在安全目录，挂载！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动elasticsearch</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span>  elasticsearch:7.6.2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动es linux就卡住了docker stats 查看 cup状态</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es是十分耗内存 1.xg 1核2G</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看docker stats</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试一下es是否成功了</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卡死……</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">赶紧关闭，增加内存的限制，修改配置文件 -e 环境配置修改</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms64m -Xmx512m&quot;</span>  elasticsearch:7.6.2</span></span><br><span class="line"></span><br><span class="line">docker stop c1d7c8435eba14eb4e87b842d53a334d5f579ffe907cac30fd5bacf862736c24</span><br></pre></td></tr></table></figure>

<p>作业：使用kibana连接es? 思考网络如何才能连接过去！</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210204174227.png" alt="image-20210204174226980"></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><ul>
<li>portainer(先用这个)</li>
<li>Rancher(CI&#x2F;CD再用)</li>
</ul>
<p><strong>什么是portainer?</strong></p>
<p>Docker图形化界面管理工具！提供一个后台面板供我们操作！</p>
<h1 id="Docker镜像详解"><a href="#Docker镜像详解" class="headerlink" title="Docker镜像详解"></a>Docker镜像详解</h1><h2 id="镜像是什么？"><a href="#镜像是什么？" class="headerlink" title="镜像是什么？"></a>镜像是什么？</h2><p>​		Docker 镜像可以看作是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
<p>要想更深入的了解 Docker 镜像，镜像的原理也必不可少，而这其中最重要的概念就是镜像层(Layers)（如下图）。镜像层依赖于一系列的底层技术，比如文件系统(filesystems)、写时复制(copy-on-write)、联合挂载(union mounts)等，幸运的是你可以在很多地方学习到<a href="https://link.zhihu.com/?target=https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/">这些技术</a>，这里就不再赘述技术细节。</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.镜像是一种轻量级、可执行的独立软件包；</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.镜像是用来打包“软件运行环境”和基于“运行环境”开发的软件；</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.镜像包含运行某个软件所需的所有内容，如代码、库、环境变量和配置文件等；</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">总结：镜像就是软件安装包，所有的应用只要打包成docker镜像，都可以通过docker直接下载、安装并运行。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="加载原理"><a href="#加载原理" class="headerlink" title="加载原理"></a>加载原理</h2><blockquote>
<p>因为Docker镜像是分层的，因此在加载一个镜像的时候，会按照从底层到高层的顺序依次加载该镜像所需要的镜像层。在加载的过程中，如果当前镜像层已经存在，则会跳过当前镜像层。比如：已经下载过MySQL镜像，现在要下载Tomcat镜像，而这两个镜像都需要CentOS镜像层，那么下载Tomcat镜像的时候，就会跳过下载CentOS镜像层。</p>
</blockquote>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><h3 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h3><blockquote>
<p>UnionFS：联合文件系统，是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层地叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。<code>UnionFS是Docker镜像的基础，镜像可以通过分层来进行继承，基于基础镜像（根镜像），可以制作各种具体的应用镜像。</code></p>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特性：一次同时加载多个文件系统，但从外面看来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="为什么会被比喻成集装箱式服务？"><a href="#为什么会被比喻成集装箱式服务？" class="headerlink" title="为什么会被比喻成集装箱式服务？"></a>为什么会被比喻成集装箱式服务？</h3><blockquote>
<p>主要原因就在于Docker镜像。简单举个例子，把Docker镜像比作一个箱子，这个箱子里有桌子、椅子、餐盘，然后饭店就可以专门订购这种箱子，用来给客户提供吃饭的服务。我们把箱子拆开，把里面的桌子、椅子、餐盘摆放好，它就可以提供吃饭服务了，这就是容器（运行起来的镜像就是容器）。然后饭店会根据实际需求，在桌子上加一双筷子，那么就是中餐馆，加上一副刀叉，那么就是西餐馆。而且，如果饭店愿意，他们可以选择把桌子、椅子、餐盘加筷子重新封装成一个新箱子，下次可以让别的中餐馆直接订购这个箱子。同样，加上刀叉重新封装， 就可以让西餐馆直接订购了。</p>
</blockquote>
<h2 id="Commit镜像"><a href="#Commit镜像" class="headerlink" title="Commit镜像"></a>Commit镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">提交容器成为一个新的副本</span></span><br><span class="line">docker commit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令和git原理类似</span></span><br><span class="line">docker commit -m=&quot;提交描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名[TAG]</span><br></pre></td></tr></table></figure>

<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、启动一个tomcat发现默认的tomcat</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、发现启动一个tomcat发现默认的tomcat根目录webapps下没有东西,这是镜像为了简化自己的原因！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、我自己copy文件进去，定制化一个自己的tomcat容器</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、我们将操作过的镜像通过commit提交为一个镜像！我们以后就可以使用我们自己修改过的镜像，这就是我们自己的镜像！</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">e2cacaa9c915   tomcat    &quot;catalina.sh run&quot;   25 minutes ago   Up 25 minutes   0.0.0.0:8081-&gt;8080/tcp   brave_taussig</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker commit -a=&quot;li5220008&quot; -m=&quot;my custom tomcat&quot; e2cacaa9c915 tomcat02:1.0 </span><br><span class="line">sha256:1aef0ba1267915da66e1598bfd253790ce3151a1ce979e95680a0956eb07c120</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">tomcat02        1.0       1aef0ba12679   14 seconds ago   654MB</span><br><span class="line">tomcat          9.0       040bdb29ab37   3 weeks ago      649MB</span><br><span class="line">tomcat          latest    040bdb29ab37   3 weeks ago      649MB</span><br><span class="line">elasticsearch   7.6.2     f29a1ee41030   10 months ago    791MB</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>学习方式：理解概念，但是一定要实践，最后实践和理论相结合一次搞定这个知识。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果你想要保存当前容器的状态，就可以通过commit来提交，获取一个镜像，</span><br><span class="line">就好比vm里面的快照的概念！</span><br></pre></td></tr></table></figure>

<p>到了这里才算是入门！</p>
<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><h3 id="什么是容器数据卷？"><a href="#什么是容器数据卷？" class="headerlink" title="什么是容器数据卷？"></a>什么是容器数据卷？</h3><p><strong>docker的理念回顾</strong></p>
<p>将应用和容器打包成一个镜像!</p>
<p>数据，如果数据都在容器中，那么我们如果容器删除，数据就会被删除，数据就会丢失！</p>
<p>需求：数据可以持久化！</p>
<p>Mysql,容器删除了，删库跑路！需求：MYSQL数据可以存储到本地！</p>
<p>容器之间可以有一个共享的技术，Docker 容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录挂载到服务中！</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210205154636.png" alt="image-20210205154629694"></p>
<p><strong>总结一句话：容器的持久化和同步操作，容器间也是可以数据共享的！</strong></p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器目录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动起来我们可以通过docker inspect 容器ID 查看容器卷挂载目录的详情信息</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210205160342.png" alt="image-20210205160342555"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试容器双向绑定过程：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、停止容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、宿主机上修改文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、启动容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、容器内的数据依旧是同步的！</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210205161940.png" alt="image-20210205161940129"></p>
<p>好处：我们以后修改只需要在本地修改即可，容器内会自动同步！</p>
<h3 id="实战：安装Mysql"><a href="#实战：安装Mysql" class="headerlink" title="实战：安装Mysql"></a>实战：安装Mysql</h3><p>思考：MySQL数据持久化问题！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">拉取mysql镜像</span></span><br><span class="line"> [root@iZwz9j1nogjvor6cio432eZ home]# docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">运行容器，需要做数据挂载！<span class="comment">#安装启动mysql,需要配置密码的，这是要注意的点</span></span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">官方测试，  docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">启动我们的mysql</span></span><br><span class="line"> [root@iZwz9j1nogjvor6cio432eZ ~]# docker run -d -p 8082:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">cc2fbe9fc11570c6ab3a2d04dacb039c122f7d21d495c8b8f802d28dcba1cb21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动成功后我们用本地的dbms navicat <span class="keyword">for</span> mysql工具连接上mysql</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dbms 连接到服务器的8082---8082和容器中的3306端口映射，这个时候我们就可以连接上了</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在本地创建一个数据<span class="built_in">test</span> 查看一下我们映射的路径是否OK</span></span><br></pre></td></tr></table></figure>

<p> 假设我们将容器删除</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207114352.png" alt="image-20210207114345035"></p>
<p>发现我们挂载到本地数据卷依旧没有丢失，这就实现了容器数据持久化的功能</p>
<h2 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看所有卷的情况</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     9e9b0e2cef7ebb2cba1dd3ebf901c1097825427aeacd33ffa7d1b49b77335c0b</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这种就是匿名挂载，我们在 -v的时候只写了容器内的路径，没写容器外的路径</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">具名挂载</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]#  docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">77a1ac62dfe7a56c1b006c95ab6ba332bb4a471eee940820734c2a60b6dc478a</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     9e9b0e2cef7ebb2cba1dd3ebf901c1097825427aeacd33ffa7d1b49b77335c0b</span><br><span class="line">local     juming-nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 卷名:容器内路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看下这个卷</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-02-07T14:20:14+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">所有docker容器内的卷，没有指定目录的情况下默认是在服务器的/var/lib/docker/volumes/xxx/_data目录下</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们通过具名挂载可以方便的找到我们的一个卷，大多数情况都使用 具名挂载</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如何确定是具名挂载还是匿名挂载，还是指定路径挂载！</span></span><br><span class="line">-v 容器内路径 				   # 匿名挂载</span><br><span class="line">-v 容器名称:容器内路径   # 具名挂载</span><br><span class="line">-v 容器外路径:容器内路径 # 指定路径挂载</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拓展</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 容器内路径:ro rw 改变路径的读写权限</span></span><br><span class="line">ro readonly			# 只读</span><br><span class="line">rw readwrite 		# 可写</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一旦这个设置了容器读写权限，容器对我们挂载出来的路径只能有对应的读写权限</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]#  docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ home]#  docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ro 只要看到ro 就说明这个路径只能通过宿主机来操作，容器内部是无法操作的！</span></span><br></pre></td></tr></table></figure>



<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><h2 id="初识Dockerfile"><a href="#初识Dockerfile" class="headerlink" title="初识Dockerfile"></a>初识Dockerfile</h2><p>Dockerfile就是用来构建Docker镜像的构建文件!命令脚本！先体验一下！</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本就是一个个命令，每个命令就是一层</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个dockerfile文件 名字可以随意起，建议 Dockerfile 官方推荐</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件中的内容 指令(大写) 参数</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ docker-test-volume]# cat dockerfile </span><br><span class="line">FROM centos</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">匿名挂载</span></span><br><span class="line">VOLUME [&quot;volumes01&quot;,&quot;volume02&quot;] </span><br><span class="line"></span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里的每一个命令都是镜像中的一层</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207145546.png" alt="image-20210207145545944"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动自己的构建的容器</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207150429.png" alt="image-20210207150429845"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个卷和宿主机外面一定有一个对应的目录</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ data]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                   NAMES</span><br><span class="line">a661eb9017bb   f8c973a10088   &quot;/bin/bash&quot;              12 seconds ago   Up 12 seconds                           interesting_meitner</span><br><span class="line">77a1ac62dfe7   nginx          &quot;/docker-entrypoint.…&quot;   50 minutes ago   Up 50 minutes   0.0.0.0:49154-&gt;80/tcp   nginx02</span><br><span class="line">e83abe18ef1c   nginx          &quot;/docker-entrypoint.…&quot;   58 minutes ago   Up 58 minutes   0.0.0.0:49153-&gt;80/tcp   nginx01</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ data]# docker inspect a661eb9017bb</span><br><span class="line">​~~~~</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;26073bb3584a359650b2274f358b31a477d2812477e07b294de61a5376166af2&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/26073bb3584a359650b2274f358b31a477d2812477e07b294de61a5376166af2/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;7d65e6573ec96ff179c52d894c34eb76d63e3e18d129afb2268d6a95755b4770&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/7d65e6573ec96ff179c52d894c34eb76d63e3e18d129afb2268d6a95755b4770/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volumes01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">​~~~</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试一下刚才我们挂载的目录是否同步出去</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ data]# ls /var/lib/docker/volumes/26073bb3584a359650b2274f358b31a477d2812477e07b294de61a5376166af2/_data/</span><br><span class="line">container.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这种方式我们未来使用的非常多，因为我们通常会构建自己的镜像！</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">假设构建镜像的时候没有挂载卷，要手动镜像挂载 -v 卷名:容器内路径！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>多个mysql同步数据！</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207155657.png" alt="image-20210207155656869"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动三个容器，通过我们刚才自己写的镜像启动</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207160247.png" alt="image-20210207160247210"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试，可以删除docker01,查看一下docker01和docker03是否还可以访问这两个文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试依旧存在，可以正常访问</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207164458.png" alt="image-20210207164458833"></p>
<p>多个mysql实现数据共享</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动我们的mysql</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker run -d -p 8082:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"> </span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker run -d -p 8083:3306  -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 volumes-from mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个时候可以实现两个容器数据同步</span></span><br></pre></td></tr></table></figure>

<p> <strong>结论：</strong></p>
<p>容器之间配置信息的传递，数据卷容器的生命周期一直维持到没有容器使用为止。</p>
<p>但是一旦你持久化到本地，这个时候本地的数据不会被删除的！</p>
<h2 id="Dockerfile介绍"><a href="#Dockerfile介绍" class="headerlink" title="Dockerfile介绍"></a>Dockerfile介绍</h2><p>Dockerfile就是用来构建Docker镜像的构建文件!命令脚本！</p>
<p>构建步骤：</p>
<ol>
<li><p>编写一个dockerfile文件</p>
</li>
<li><p>docker build 构建成为一个镜像</p>
</li>
<li><p>docker run 运行镜像</p>
</li>
<li><p>docker push 发布镜像（DockerHub、阿里云镜像仓库）</p>
</li>
</ol>
<p>查看一下官方是如何构建镜像的</p>
<p> <img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207171434.png" alt="image-20210207171434719"></p>
<p>很多官方镜像都是基础包，很多功能没有，我们通常需要自己搭建自己的镜像！</p>
<p>官方既然可以制作镜像我们也可以！</p>
<h2 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h2><p><strong>基础知识</strong></p>
<ol>
<li><p>每个保留关键字（指令）都必须是大写字母</p>
</li>
<li><p>从上到下按顺序执行</p>
</li>
<li><p>#标识注释</p>
</li>
<li><p>每一个指令都会创建提交一个镜像层，并提交!</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207172401.png" alt="image-20210207172401064"></p>
</li>
</ol>
<p>dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分重要！</p>
<p>Docker镜像逐渐成为企业交付的标准，必须要掌握！</p>
<p>步骤：开发、部署、运维 缺一不可！</p>
<p>DockerFile: 构建文件，定义了一切的步骤，源代码</p>
<p>Dockerimages:通过DockerFile 构建生成的镜像，最终发布和运行的产品</p>
<p>Docker容器：容器就是镜像运行起来提供服务的 </p>
<h2 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM 						# 基础镜像，一切从这里构建</span><br><span class="line">MAINTAINER			# 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN							# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD							# 添加内容 步骤：tomcat镜像，这个tomcat压缩包！</span><br><span class="line">WORKDIR					# 镜像的工作目录</span><br><span class="line">VOLUME					# 挂载目录</span><br><span class="line">EXPOSE					# 暴露端口配置</span><br><span class="line">CMD							# 指定这个容器启动的时候运行的命令 (只有最后一个生效，可被替代)</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候运行的命令 可以追加命令</span><br><span class="line">ONBUILD					# 当构建一个被继承DockerFile 这个时候就会运行 ONBUILD的指令，触发指令</span><br><span class="line">COPY						# 类似ADD命令，将我们的文件拷贝到镜像中</span><br><span class="line">EVN							# 构建的时候设置环境变量！</span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210208110753.png" alt="image-20210208110744714"></p>
<h2 id="实战测试-1"><a href="#实战测试-1" class="headerlink" title="实战测试"></a>实战测试</h2><p>Docker Hub 中 99%镜像都是从这个基础镜过来的 FROM scratch，然后配置我们需要的软件和配置来进行构建</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210207171434.png" alt="image-20210207171434719"></p>
<blockquote>
<p>自己创建一个centos镜像 </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、编写一个我们的DockerFile文件</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ dockerfile]# vim mydockerfile-centos</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER li5220008@qq.com</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 8083</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;--------end----------&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、通过这个文件我们构建镜像</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令 docker build -f dockerfile文件路径 -t 镜像名:[tag]</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line">​~~~</span><br><span class="line">Successfully built 1dac1bdcadd8</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、运行测试我们的镜像</span></span><br></pre></td></tr></table></figure>

<p>对比：原生的centos镜像 </p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210208120147.png" alt="image-20210208120147028"></p>
<p>我们增加之后的镜像</p>
<p> <img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210208120329.png" alt="image-20210208120329417"></p>
<p>我们可以列出本地镜像构建的历史信息</p>
<p> <img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210208120658.png" alt="image-20210208120657941"></p>
<p>我们平时拿到一个镜像就可以通过这个命令探究一下是怎么做的了？</p>
<blockquote>
<p>CMD 和 ENTRYPOINT区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD    				# 指这个容器启动的时候要执行的命令，只有最后一个有效，可以被替换</span><br><span class="line">ENTRYPOINT 		# 指这个容器启动的时候要执行的命令，可以追加命令</span><br></pre></td></tr></table></figure>

<p>测试CMD</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写 dockerfile 文件</span></span><br><span class="line">[root@li5220008 dockerfile]# vim mydockerfile-centos</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line">[root@li5220008 dockerfile]# docker build -f mydockerfile-centos -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">7a0437f04f83: Pull complete </span><br><span class="line">Digest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> a40ddabff957</span></span><br><span class="line">Removing intermediate container a40ddabff957</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">b8e3c8506f00</span></span><br><span class="line">Successfully built b8e3c8506f00</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试运行我们的镜像</span></span><br><span class="line">[root@li5220008 dockerfile]# docker run b8e3c8506f00</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">想追加一个命令 -l    <span class="built_in">ls</span> -al</span></span><br><span class="line">[root@li5220008 dockerfile]# docker run b8e3c8506f00 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cmd的情况下 -l 替换了CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>] 命令，-l不是命令所以报错</span></span><br><span class="line">[root@li5220008 dockerfile]# docker run b8e3c8506f00 ls -la</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Feb 22 02:26 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Feb 22 02:26 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Feb 22 02:26 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Feb 22 02:26 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Feb 22 02:26 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 131 root root   0 Feb 22 02:26 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Feb 22 02:26 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Dec  4 17:37 var </span><br></pre></td></tr></table></figure>

<p>测试ENTRYPOINT</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 dockerfile]# vim dockerfile-cmd-entrypoint</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line">[root@li5220008 dockerfile]# docker build -f dockerfile-cmd-entrypoint -t entrypoint-test .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> b9c10c3f79e9</span></span><br><span class="line">Removing intermediate container b9c10c3f79e9</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">fa6005183c68</span></span><br><span class="line">Successfully built fa6005183c68</span><br><span class="line">Successfully tagged entrypoint-test:latest</span><br><span class="line">[root@li5220008 dockerfile]# docker run fa6005183c68</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们的追加命令，是直接拼接在我们ENTRYPOINT 命令后面！</span></span><br><span class="line">[root@li5220008 dockerfile]# docker run fa6005183c68 -l</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Feb 22 02:32 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Feb 22 02:32 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Feb 22 02:32 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Feb 22 02:32 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Feb 22 02:32 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 129 root root   0 Feb 22 02:32 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Feb 22 02:32 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Dec  4 17:37 var</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Dockerflile中很多命令都十分相似，我们需要了解他们的区别，我们最好的学习方式就是去练习对比他们的测试效果！</p>
<h2 id="实战：Tomcat镜像"><a href="#实战：Tomcat镜像" class="headerlink" title="实战：Tomcat镜像"></a>实战：Tomcat镜像</h2><ol>
<li><p>准备镜像文件 tomcat压缩包，jdk的压缩包</p>
</li>
<li><p>编写dockerfile文件，官方命名Dockerfile,build会自动寻找这个文件，就不需要-f指定了！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ tomcat]# cat Dockerfile </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER li5220008@163.com</span><br><span class="line"></span><br><span class="line">COPY readme.md /usr/local/readme.md</span><br><span class="line"></span><br><span class="line">ADD jdk-8u281-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-7.0.90.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_281</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-7.0.90</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-7.0.90</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-7.0.90/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-7.0.90/logs/catalina.out</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ tomcat]docker build -t diytomcat .</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ tomcat]# docker run -d -p 8083:8080 --name li5220008tomcat -v /home/ceshi/tomcat/test:/usr/local/apache-tomcat-7.0.90/webapps/test -v /home/ceshi/tomcat/tomcatlogs:/usr/local/apache-tomcat-7.0.90/logs diytomcat</span><br><span class="line">1c7470cc8f4a499a936059eb249fc0b2e488daaa2d206a6ba1d3d5dc982859aa</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问测试</p>
</li>
<li><p>发布项目（由于做了卷挂载，我们直接在本地编写项目就可以发不了！）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">						   http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">System.out.print(<span class="string">&quot;Hello Li5220008!&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>发现：项目部署成功，可以直接访问OK!</p>
<p>我们以后开发的步骤：需要掌握dockerfile的编写！我们之后的一切都是用Docker镜像来发布运行！</p>
</li>
</ol>
<h2 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h2><blockquote>
<p>Dockerhub</p>
</blockquote>
<ol>
<li><p>地址<a target="_blank" rel="noopener" href="https://hub.docker.com/%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%A6%E5%8F%B7">https://hub.docker.com/注册自己的账号</a></p>
</li>
<li><p>确保自己的账号可以登录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 ~]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line">  </span><br><span class="line">[root@li5220008 ~]# docker login -u li5220008</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>在我们的服务器上提交自己的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">现在本地创建一个tag 版本</span></span><br><span class="line">[root@li5220008 tomcat]# docker tag diytomcat li5220008/diytomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交镜像</span></span><br><span class="line">[root@li5220008 tomcat]# docker push li5220008/diytomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/li5220008/diytomcat]</span><br><span class="line">e8113aa6d150: Pushing [=====================&gt;                             ]  25.39MB/58.05MB</span><br><span class="line">f517716132d3: Pushing [==========================================&gt;        ]  12.08MB/14.07MB</span><br><span class="line">881500615708: Pushing [==&gt;                                                ]  16.44MB/356.6MB</span><br><span class="line">223b85a6e463: Pushed </span><br><span class="line">2653d992f4ef: Pushing [=====&gt;                                             ]  23.45MB/209.3MB</span><br><span class="line">^C</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提交的时候也是按照镜像的层级来进行提交的</p>
</li>
</ol>
<blockquote>
<p>阿里云镜像服务</p>
</blockquote>
<ol>
<li><p>登录阿里云</p>
</li>
<li><p>找到容器镜像服务</p>
</li>
<li><p>创建命名空间</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210210203610.png" alt="image-20210210203603143"></p>
</li>
<li><p>创建容器镜像</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210210203846.png" alt="image-20210210203846733"></p>
</li>
<li><p>浏览阿里云</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210210204255.png" alt="image-20210210204255202"></p>
</li>
<li><p>推送到阿里云仓库</p>
<blockquote>
<p>阿里云镜像的就参考官方地址：</p>
</blockquote>
<h4 id="1-登录阿里云Docker-Registry"><a href="#1-登录阿里云Docker-Registry" class="headerlink" title="1. 登录阿里云Docker Registry"></a>1. 登录阿里云Docker Registry</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=王红891212 registry.cn-shenzhen.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</p>
<p>您可以在访问凭证页面修改凭证密码。</p>
<h4 id="2-从Registry中拉取镜像"><a href="#2-从Registry中拉取镜像" class="headerlink" title="2. 从Registry中拉取镜像"></a>2. 从Registry中拉取镜像</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-shenzhen.aliyuncs.com/li5220008/diytomcat:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h4 id="3-将镜像推送到Registry"><a href="#3-将镜像推送到Registry" class="headerlink" title="3. 将镜像推送到Registry"></a>3. 将镜像推送到Registry</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=王红891212 registry.cn-shenzhen.aliyuncs.com$ sudo docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/li5220008/diytomcat:[镜像版本号]$ sudo docker push registry.cn-shenzhen.aliyuncs.com/li5220008/diytomcat:[镜像版本号]</span><br></pre></td></tr></table></figure>

<p>请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p>
<h4 id="4-选择合适的镜像仓库地址"><a href="#4-选择合适的镜像仓库地址" class="headerlink" title="4. 选择合适的镜像仓库地址"></a>4. 选择合适的镜像仓库地址</h4><p>从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p>
<p>如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-shenzhen.aliyuncs.com 作为Registry的域名登录。</p>
</li>
<li><p>小结：</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210211003839.png" alt="image-20210211003839140"></p>
<h1 id="Docker网络-进阶段"><a href="#Docker网络-进阶段" class="headerlink" title="Docker网络(进阶段)"></a>Docker网络(进阶段)</h1><h2 id="理解Docker0"><a href="#理解Docker0" class="headerlink" title="理解Docker0"></a>理解Docker0</h2><blockquote>
<p>测试</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210211004839.png" alt="image-20210211004839069"></p>
<p>三个网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题 docker是如何处理容器网络访问的？</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210211005113.png" alt="image-20210211005112924"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run -d -P --name tomcat01 tomcat</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器内网络地址 ip addr 发现容器启动的时候会得到一个etho 地址</span></span><br><span class="line">[root@li5220008 ~]# docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">62: eth0@if63: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">思考，linux 能不能ping通容器内部！</span></span><br><span class="line">[root@li5220008 ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.066 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.064 ms</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">说明linux 可以ping通docker 容器内部</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li><p>我们每启动一个docker容器，docker就会给docker容器分配一个ip,我们只要安装了docker就会有一个网卡docker0 桥接模式，使用的技术是evth-pair技术</p>
<p>再次测试服务器上的ip addr</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:06:81:84 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.188.74/20 brd 172.18.191.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 314372800sec preferred_lft 314372800sec</span><br><span class="line">    inet6 fe80::216:3eff:fe06:8184/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:96:60:ac:34 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:96ff:fe60:ac34/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">63: veth87524ca@if62: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 2a:57:08:39:c2:62 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::2857:8ff:fe39:c262/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>再启动一个tomcat02容器测试，发现又多了一对网卡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 ~]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">e7f5606309acf25d4f4c3c47ed373dac84bc66900adce11735c9a409abf3c2d7</span><br><span class="line">[root@li5220008 ~]# docker exec -it tomcat02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">64: eth0@if65: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器内与服务器外的网卡成对</span></span><br><span class="line">[root@li5220008 ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:06:81:84 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.188.74/20 brd 172.18.191.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 314372545sec preferred_lft 314372545sec</span><br><span class="line">    inet6 fe80::216:3eff:fe06:8184/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:96:60:ac:34 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:96ff:fe60:ac34/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">63: veth87524ca@if62: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 2a:57:08:39:c2:62 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::2857:8ff:fe39:c262/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">65: veth43c1ad3@if64: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 3e:fb:64:3e:f6:4b brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::3cfb:64ff:fe3e:f64b/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们发现这个网卡带来的网卡，都是一对一对的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">evth-pair 就是一对虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正因为有这个特性，evth-pait 充当一个桥梁，连接各种虚拟设备的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OpenStac,Docker容器之间的连接，ovs的连接，都是使用evth-pair 技术</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>我们来测试tomcat01和tomcat02是否可以ping通？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 ~]# docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.164 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.090 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.093 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.111 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>总结：docker 容器与容器之间的可以ping通的</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210218163502.png" alt="image-20210218163455477"></p>
<blockquote>
<p>结论：tomcat01 和 tomcat02是共用同一个路由器 docker0</p>
<p>所有的容器不指定网络的情况下默认都是docker0路由的，docker会给我们默认分配一个默认的ip</p>
<p>拓展网络知识：</p>
<p>255.255.0.1&#x2F;16 域 局域网</p>
<p>00000000.00000000.00000000.00000000</p>
<p>255.255.255.255</p>
</blockquote>
<blockquote>
<p>小结：Docker使用的linux的桥接，宿主机中是一个Docker容器的网桥 docker0.</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210218164342.png" alt="image-20210218164342459"></p>
<p>Docker中所有的网络接口都是虚拟的，虚拟的转发效率高！（内网传递文件！）</p>
<p>只要容器删除对应的网桥一对evth-pair网络就没了！</p>
<blockquote>
<p>思考一个场景，我们编写了一个微服务，database url&#x3D;ip:项目不重启，数据库ip换掉了，我们可以希望可以处理这个问题，可以用名字来访问容器？</p>
</blockquote>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@li5220008 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">58a85e688d75   bridge    bridge    local</span><br><span class="line">99e835029fc6   host      host      local</span><br><span class="line">c4d8f8c6769e   none      null      local</span><br></pre></td></tr></table></figure>

<p><strong>网络模式</strong></p>
<p>bridge：桥接 docker大桥 (默认，自己架设也使用桥，默认)</p>
<p>none：不配置网络</p>
<p>host：和宿主机共享网络</p>
<p>container：容器内可以网络连通！(局限性很大，不建议使用，用得少)</p>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们直接启动的命令 --net bridge 而这个就是我们默认的docker0</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat tomcat</span><br><span class="line">docker run -d -P --name tomcat01 tomcat --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0特点，默认，域名不能访问，--<span class="built_in">link</span> 可以打通连接！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以自定义一个网络！</span></span><br><span class="line">[root@li5220008 ~]# docker network create -d bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">5c53e253abfadf1ab1cb9582914d1ba467663fd00adb466878d35c8c6f840d72</span><br><span class="line">[root@li5220008 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">58a85e688d75   bridge    bridge    local</span><br><span class="line">99e835029fc6   host      host      local</span><br><span class="line">5c53e253abfa   mynet     bridge    local</span><br><span class="line">c4d8f8c6769e   none      null      local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看我们自己的网络就创建好了</span></span><br><span class="line">[root@li5220008 ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;5c53e253abfadf1ab1cb9582914d1ba467663fd00adb466878d35c8c6f840d72&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-02-18T17:16:40.764317521+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@li5220008 ~]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">da8b3d3b669f91294cae051063580a1becd4f975290f42dc2f413d4758f7c97e</span><br><span class="line">[root@li5220008 ~]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">4a82399c617952e4c33aea70f754b75ad63b53f02a8b53fe409f7bc2c066cc3e</span><br><span class="line">[root@li5220008 ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;5c53e253abfadf1ab1cb9582914d1ba467663fd00adb466878d35c8c6f840d72&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-02-18T17:16:40.764317521+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;4a82399c617952e4c33aea70f754b75ad63b53f02a8b53fe409f7bc2c066cc3e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;b3d64317f53a2e31a8f7e64ea8230d66a0b22ac9d3c8fb623c653afebafeb865&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;da8b3d3b669f91294cae051063580a1becd4f975290f42dc2f413d4758f7c97e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;be7fdd08caa4a292ccfadb20c01930d9fb49b75a829e725566215e8bad105e2c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次测试我们的ping连接</span></span><br><span class="line">[root@li5220008 ~]# docker exec -it tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.147 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.113 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.104 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 40ms</span><br><span class="line">rtt min/avg/max/mdev = 0.104/0.121/0.147/0.020 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">现在我们不使用 --<span class="built_in">link</span> 也可以ping我们的名字了</span></span><br><span class="line">[root@li5220008 ~]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.099 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.096 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 38ms</span><br><span class="line">rtt min/avg/max/mdev = 0.094/0.096/0.099/0.008 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们自定义的网络docker已经帮我们维护我了对应关系，推荐我们平时使用的时候都使用自定义的网络！</p>
<p>好处：</p>
<p>redis集群：不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>mysql集群：不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看命令帮助</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker network connect --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试打通tomcat01 -&gt; mynet</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker network connect mynet tomcat01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连通之后就是将 tomcat01 放到了mynet网络下</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个容器两个ip地址</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">类似阿里云服务器：公网IP 私网IP</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;5c53e253abfadf1ab1cb9582914d1ba467663fd00adb466878d35c8c6f840d72&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-02-18T17:16:40.764317521+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;477ea1c175a8ded9d8264ca799649e523c8659e68701b61704ad3e4d750862b0&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;16e37f9c2cd81093d0321e31c2f51fa5b40a1e1d5035fc3b0ac3e898f548e82d&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;4a82399c617952e4c33aea70f754b75ad63b53f02a8b53fe409f7bc2c066cc3e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;b3d64317f53a2e31a8f7e64ea8230d66a0b22ac9d3c8fb623c653afebafeb865&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;da8b3d3b669f91294cae051063580a1becd4f975290f42dc2f413d4758f7c97e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;be7fdd08caa4a292ccfadb20c01930d9fb49b75a829e725566215e8bad105e2c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试tomca01连接mynet OK</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.139 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.104 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.096 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 39ms</span><br><span class="line">rtt min/avg/max/mdev = 0.096/0.113/0.139/0.018 ms</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it tomcat01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.132 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.114 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.111 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tomcat02是不通的</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ ~]# docker exec -it tomcat02 ping tomcat-net-01</span><br><span class="line">\\ping: tomcat-net-01: Name or service not known</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>结论：假设需要夸网络操作别人，就需要使用docker network connect 连通……</p>
</blockquote>
<h2 id="实战：部署Redis集群"><a href="#实战：部署Redis集群" class="headerlink" title="实战：部署Redis集群"></a>实战：部署Redis集群</h2><p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210219150137.png" alt="image-20210219150127671"></p>
<p>……</p>
<h2 id="SpringBoot微服务打包Docker镜像"><a href="#SpringBoot微服务打包Docker镜像" class="headerlink" title="SpringBoot微服务打包Docker镜像"></a>SpringBoot微服务打包Docker镜像</h2><ol>
<li><p>构建SpringBoot项目</p>
<blockquote>
<p>拿本地ccmb2b2c测试</p>
</blockquote>
</li>
<li><p>打包应用</p>
<p><img src="https://cdn.jsdelivr.net/gh/li5220008/cloudimages/imgs/20210220155021.png" alt="image-20210220155012937"></p>
</li>
<li><p>编写Dockerfile</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>打包镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9j1nogjvor6cio432eZ idea]# docker build -t ccmb2b2c .</span><br><span class="line">Sending build context to Docker daemon  73.98MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">d23bdf5b1b1b</span></span><br><span class="line">Step 2/5 : COPY *.jar /app.jar</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">1aef714c054d</span></span><br><span class="line">Step 3/5 : CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 1a38eb517343</span></span><br><span class="line">Removing intermediate container 1a38eb517343</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">d19ae786e3da</span></span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 4388de1a5bb3</span></span><br><span class="line">Removing intermediate container 4388de1a5bb3</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">6d208bef2aaa</span></span><br><span class="line">Step 5/5 : ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 9ef2080bd314</span></span><br><span class="line">Removing intermediate container 9ef2080bd314</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">ddd264af2475</span></span><br><span class="line">Successfully built ddd264af2475</span><br><span class="line">Successfully tagged ccmb2b2c:latest</span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ idea]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">ccmb2b2c     latest    ddd264af2475   7 seconds ago   717MB</span><br><span class="line">tomcat       latest    040bdb29ab37   5 weeks ago     649MB</span><br><span class="line">java         8         d23bdf5b1b1b   4 years ago     643MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>测试web服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动实例容器</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ idea]# docker run -d -P --name ccmb2b2c-admin ccmb2b2c</span><br><span class="line">ca168de31bc4e7feb6adc9007d4baf8a971475fd65cf55c3a0663ba29a0d52a9</span><br><span class="line"></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ idea]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND                  CREATED         STATUS         PORTS                     NAMES</span><br><span class="line">ca168de31bc4   ccmb2b2c   &quot;java -jar /app.jar …&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:49159-&gt;8080/tcp   ccmb2b2c-admin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试web容器</span></span><br><span class="line">[root@iZwz9j1nogjvor6cio432eZ idea]# curl -v localhost:49159</span><br><span class="line">* Rebuilt URL to: localhost:49159/</span><br><span class="line">*   Trying ::1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* connect to ::1 port 49159 failed: Connection refused</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to localhost (127.0.0.1) port 49159 (#0)</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET / HTTP/1.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Host: localhost:49159</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">User-Agent: curl/7.61.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Accept: */*</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&lt; HTTP/1.1 404</span> </span><br><span class="line">&lt; Vary: Origin</span><br><span class="line">&lt; Vary: Access-Control-Request-Method</span><br><span class="line">&lt; Vary: Access-Control-Request-Headers</span><br><span class="line">&lt; Content-Type: application/json</span><br><span class="line">&lt; Transfer-Encoding: chunked</span><br><span class="line">&lt; Date: Sat, 20 Feb 2021 07:12:50 GMT</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host localhost left intact</span><br><span class="line">&#123;&quot;timestamp&quot;:&quot;2021-02-20T07:12:49.893+00:00&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:&quot;&quot;,&quot;path&quot;:&quot;/&quot;&#125;[root@iZwz9j1nogjvor6cio432eZ idea]# ^C</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="企业实战"><a href="#企业实战" class="headerlink" title="企业实战"></a>企业实战</h1><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><h2 id="CI-x2F-CD-Jenkins-流水线"><a href="#CI-x2F-CD-Jenkins-流水线" class="headerlink" title="CI&#x2F;CD Jenkins 流水线"></a>CI&#x2F;CD Jenkins 流水线</h2>
</article>

    <div class="pagenator post-pagenator">
    
    
        <a class="extend prev post-prev" href="/2023/02/21/Java8%20Stream%E8%AF%A6%E8%A7%A3/">prev</a>
    

    
    <p>last update time 2023-08-05</p>
    
    
        <a class="extend next post-next" href="/2023/01/25/Linux%E6%80%BB%E7%BB%93/">next</a>
    
    </div>


    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
	</ul>
</div>
    <div class="copyright">
        <span>
            
            
            
                © 洪志鑫 2022 - 2023
            
        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10); 
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
